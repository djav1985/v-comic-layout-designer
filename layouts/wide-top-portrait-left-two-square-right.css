.layout.wide-top-portrait-left-two-square-right {
    --gutter-h: 12px;         /* left & right frame */
    --gutter-top: 36px;       /* top gutter */
    --gutter-bottom: 60px;    /* bottom gutter */
    --gutter-middle-v: 24px;  /* separation between top banner and bottom row */
    --gutter-stack: 14px;     /* gap between stacked square panels */
    --gutter-column: 16px;    /* horizontal spacing between portrait and squares */

    --available-width: calc(100% - (2 * var(--gutter-h)));
    --available-height: calc(100% - var(--gutter-top) - var(--gutter-bottom));

    /* Top panel targets ≈16:9 but stays proportional to the page height */
    --top-panel-height: clamp(
        calc(var(--available-height) * 0.24),
        calc(var(--available-width) * (9 / 16)),
        calc(var(--available-height) * 0.52)
    );

    /* Bottom composition occupies the remaining height on the page */
    --bottom-area-top: calc(var(--gutter-top) + var(--top-panel-height) + var(--gutter-middle-v));
    --bottom-area-height: max(
        0px,
        calc(100% - var(--gutter-top) - var(--gutter-bottom) - var(--gutter-middle-v) - var(--top-panel-height))
    );

    --bottom-area-width: var(--available-width);
    --portrait-ratio: 1.7777778;
    --portrait-max-width: max(0px, calc(var(--bottom-area-width) - var(--gutter-column)));
    --portrait-min-width: min(
        calc(var(--bottom-area-width) * 0.32),
        var(--portrait-max-width)
    );
    --portrait-preferred-width: calc(var(--bottom-area-height) / var(--portrait-ratio));
    --bottom-left-width: clamp(
        var(--portrait-min-width),
        var(--portrait-preferred-width),
        var(--portrait-max-width)
    );

    --bottom-right-width: max(
        0px,
        calc(var(--bottom-area-width) - var(--bottom-left-width) - var(--gutter-column))
    );

    --square-vertical-allowance: max(0px, calc((var(--bottom-area-height) - var(--gutter-stack)) / 2));
    --square-size: max(0px, min(var(--bottom-right-width), var(--square-vertical-allowance)));
}

/* Wide cinematic panel across the top */
.layout.wide-top-portrait-left-two-square-right .panel1 {
    position: absolute;
    top: var(--gutter-top);
    left: var(--gutter-h);
    width: var(--available-width);
    height: var(--top-panel-height);
}

/* Tall portrait panel on the bottom left (≈9:16) */
.layout.wide-top-portrait-left-two-square-right .panel2 {
    position: absolute;
    top: var(--bottom-area-top);
    left: var(--gutter-h);
    width: var(--bottom-left-width);
    height: var(--bottom-area-height);
}

/* First square on the bottom right stack (≈1:1) */
.layout.wide-top-portrait-left-two-square-right .panel3 {
    position: absolute;
    top: var(--bottom-area-top);
    left: calc(var(--gutter-h) + var(--bottom-left-width) + var(--gutter-column));
    width: var(--bottom-right-width);
    height: var(--square-size);
}

/* Second square on the bottom right stack (≈1:1) */
.layout.wide-top-portrait-left-two-square-right .panel4 {
    position: absolute;
    top: calc(var(--bottom-area-top) + var(--square-size) + var(--gutter-stack));
    left: calc(var(--gutter-h) + var(--bottom-left-width) + var(--gutter-column));
    width: var(--bottom-right-width);
    height: var(--square-size);
}

/* Keep the full composition within the page frame */
.layout.wide-top-portrait-left-two-square-right .panel1,
.layout.wide-top-portrait-left-two-square-right .panel2,
.layout.wide-top-portrait-left-two-square-right .panel3,
.layout.wide-top-portrait-left-two-square-right .panel4 {
    border-radius: inherit;
}
